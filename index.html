<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Table Generator â€” Blogger (Fixed)</title>
<style>
:root{--accent:#3b82f6;--bg:#f8fafc;--card:#fff;--text:#334155;--border:#e2e8f0}
html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
.container{max-width:1000px;margin:30px auto;padding:20px}
.header{margin-bottom:20px;border-bottom:1px solid var(--border);padding-bottom:15px}
.h1{font-size:20px;font-weight:700;color:#0f172a}
.card{background:var(--card);border-radius:8px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1);margin-bottom:16px;border:1px solid var(--border)}
.label{font-size:12px;font-weight:600;color:#64748b;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px}
.input,textarea,select{width:100%;padding:10px;border-radius:6px;border:1px solid var(--border);font-family:inherit;font-size:14px;box-sizing:border-box;background:#fff}
textarea{min-height:80px;resize:vertical}
.btn{background:var(--accent);color:#fff;border:none;padding:8px 14px;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:background 0.2s}
.btn:hover{background:#2563eb}
.btn.secondary{background:#f1f5f9;color:#334155;border:1px solid var(--border)}
.btn.secondary:hover{background:#e2e8f0}
.btn-group{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}

/* Layout Grid */
.grid{display:grid;grid-template-columns:1.2fr 0.8fr;gap:20px}
@media(max-width:768px){.grid{grid-template-columns:1fr}}

/* Editor Table */
.editor-wrap{overflow:auto;max-height:400px;border:1px solid var(--border);border-radius:6px;background:#fff}
#editor-table{width:100%;border-collapse:collapse;min-width:400px}
#editor-table th{background:#f1f5f9;font-weight:600;text-align:left;position:sticky;top:0;z-index:10}
#editor-table th,#editor-table td{padding:10px;border:1px solid var(--border);min-width:50px;vertical-align:top}
#editor-table [contenteditable]:focus{outline:2px solid var(--accent);outline-offset:-2px;background:#eff6ff}

/* Preview & Code */
.preview-box{background:#fff;border:1px solid var(--border);border-radius:6px;padding:10px;min-height:100px;overflow:hidden}
.code-box{width:100%;height:250px;background:#1e293b;color:#e2e8f0;font-family:'Menlo','Monaco',monospace;font-size:12px;padding:12px;border-radius:6px;border:none;resize:vertical}

/* Helper classes */
.mt-2{margin-top:8px} .mb-2{margin-bottom:8px}
.note{font-size:12px;color:#94a3b8;margin-top:6px}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="h1">Table Generator for Blogger</div>
    <div class="note">Buat tabel responsive dengan fitur scroll & drag.</div>
  </div>

  <div class="grid">
    <div>
      <div class="card">
        <div class="label">1. Definisi Kolom</div>
        <textarea id="col-input" placeholder="Masukkan nama kolom (pisahkan dengan koma). Contoh:&#10;Produk, Harga, Spesifikasi, Link Pembelian"></textarea>
        <div class="btn-group">
          <button id="create-cols" class="btn">Set Header</button>
          <button id="reset" class="btn secondary">Reset Semua</button>
        </div>
      </div>

      <div class="card">
        <div class="label">2. Isi Data Tabel</div>
        <div class="editor-wrap">
          <table id="editor-table">
            <thead><tr><th contenteditable="true">Kolom 1</th><th contenteditable="true">Kolom 2</th></tr></thead>
            <tbody><tr><td contenteditable="true">Isi data...</td><td contenteditable="true">Isi data...</td></tr></tbody>
          </table>
        </div>
        <div class="btn-group">
          <button id="add-row" class="btn secondary">+ Tambah Baris</button>
        </div>
        <div class="note mt-2">Tips: Tekan <b>Enter</b> di dalam sel untuk baris baru.</div>
      </div>

      <div class="card">
        <div class="label">3. Dapatkan Kode</div>
        <div class="btn-group">
          <button id="generate-btn" class="btn">Generate HTML</button>
          <button id="preview-btn" class="btn secondary">Lihat Preview</button>
        </div>
      </div>
    </div>

    <div>
      <div class="card">
        <div class="label">Pengaturan Output</div>
        <div class="mb-2">
          <div class="note">Min Width Tabel (px)</div>
          <input type="number" id="minw" value="600" class="input">
        </div>
        <div class="mb-2">
          <div class="note">Max Height Scroll (vh)</div>
          <input type="number" id="maxh" value="60" class="input">
        </div>
        <div class="mb-2">
          <div class="note">Mode Baris (Wrap Text)</div>
          <select id="nowrap-toggle" class="input">
            <option value="no">Wrap (Teks turun ke bawah)</option>
            <option value="yes">No Wrap (Satu baris panjang)</option>
          </select>
        </div>
      </div>

      <div class="card">
        <div class="label">Live Preview</div>
        <div id="preview" class="preview-box">
            <div style="color:#94a3b8;text-align:center;padding:20px;">Klik "Lihat Preview"</div>
        </div>
      </div>

      <div class="card">
        <div class="label">Kode Hasil (Copy ke HTML Blogger)</div>
        <textarea id="code" class="code-box" readonly>// Kode akan muncul di sini...</textarea>
        <div class="btn-group">
          <button id="copy-btn" class="btn">Copy Code</button>
          <button id="download-btn" class="btn secondary">Download .html</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
/* --- HELPERS --- */
const $ = id => document.getElementById(id);
const escapeHtml = (unsafe) => {
    return (unsafe || "").replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
}

/* --- STATE & ELEMENTS --- */
const els = {
    colInput: $('col-input'),
    createCols: $('create-cols'),
    reset: $('reset'),
    editorTable: $('editor-table'),
    addRow: $('add-row'),
    generate: $('generate-btn'),
    previewBtn: $('preview-btn'),
    previewBox: $('preview'),
    codeOut: $('code'),
    copyBtn: $('copy-btn'),
    downloadBtn: $('download-btn'),
    minw: $('minw'),
    maxh: $('maxh'),
    nowrap: $('nowrap-toggle')
};

/* --- EDITOR LOGIC --- */

// Handle enter key in contenteditable to insert <br> instead of <div>
function bindCellEvents(cell) {
    if(!cell) return;
    cell.setAttribute('contenteditable', 'true');
    // Remove old listeners to avoid duplicates if re-binding
    cell.onkeydown = function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            document.execCommand('insertHTML', false, '<br><br>');
        }
    };
}

// Apply to initial cells
els.editorTable.querySelectorAll('th, td').forEach(bindCellEvents);

// 1. Set Columns
els.createCols.addEventListener('click', () => {
    const txt = els.colInput.value.trim();
    if (!txt) return alert('Masukkan nama kolom dulu!');
    const cols = txt.split(/[\n,]+/).map(s => s.trim()).filter(Boolean);
    
    const thead = els.editorTable.querySelector('thead') || els.editorTable.createTHead();
    const tbody = els.editorTable.querySelector('tbody') || els.editorTable.createTBody();

    // Rebuild Header
    thead.innerHTML = `<tr>${cols.map(c => `<th contenteditable="true">${c}</th>`).join('')}</tr>`;
    
    // Sync Body Rows
    const rows = Array.from(tbody.querySelectorAll('tr'));
    if (rows.length === 0) {
        // Create 1 empty row if none
        tbody.innerHTML = `<tr>${cols.map(() => `<td contenteditable="true"></td>`).join('')}</tr>`;
    } else {
        rows.forEach(tr => {
            const currentCells = tr.children.length;
            const diff = cols.length - currentCells;
            if (diff > 0) {
                for(let i=0; i<diff; i++) {
                    const td = document.createElement('td');
                    tr.appendChild(td);
                }
            } else if (diff < 0) {
                for(let i=0; i<Math.abs(diff); i++) {
                    if(tr.lastElementChild) tr.removeChild(tr.lastElementChild);
                }
            }
        });
    }
    // Re-bind events
    els.editorTable.querySelectorAll('th, td').forEach(bindCellEvents);
});

// 2. Add Row
els.addRow.addEventListener('click', () => {
    const tbody = els.editorTable.querySelector('tbody') || els.editorTable.createTBody();
    const colCount = els.editorTable.querySelector('thead tr').children.length;
    const tr = document.createElement('tr');
    for(let i=0; i<colCount; i++) {
        const td = document.createElement('td');
        tr.appendChild(td);
    }
    tbody.appendChild(tr);
    els.editorTable.querySelectorAll('td').forEach(bindCellEvents);
});

// 3. Reset
els.reset.addEventListener('click', () => {
    if(!confirm('Reset tabel?')) return;
    els.editorTable.innerHTML = '<thead><tr><th contenteditable="true">Kolom 1</th><th contenteditable="true">Kolom 2</th></tr></thead><tbody><tr><td contenteditable="true">Data...</td><td contenteditable="true">Data...</td></tr></tbody>';
    els.colInput.value = '';
    els.codeOut.value = '// Kode akan muncul di sini...';
    els.previewBox.innerHTML = '<div style="color:#94a3b8;text-align:center;padding:20px;">Preview Reset</div>';
    els.editorTable.querySelectorAll('th, td').forEach(bindCellEvents);
});

/* --- GENERATOR LOGIC --- */

function buildTableHTML() {
    const clone = els.editorTable.cloneNode(true);
    // Clean up contenteditable attributes
    clone.querySelectorAll('*').forEach(el => {
        el.removeAttribute('contenteditable');
        el.removeAttribute('style'); // remove outline styles if any
    });
    
    // Apply nowrap class if selected
    if (els.nowrap.value === 'yes') {
        clone.classList.add('no-wrap');
    }

    // Get pure HTML
    return clone.outerHTML;
}

function getOutputCSS(minw, maxh) {
    return `<style>
/* Table Generator Styles */
.bb-table-wrap {
  position: relative;
  overflow: auto;
  width: 100%;
  max-height: ${maxh}vh;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  margin: 1.5rem 0;
  background: #fff;
  border: 1px solid #e2e8f0;
}
.bb-table-wrap table {
  width: 100%;
  min-width: ${minw}px;
  border-collapse: collapse;
  font-size: 14px;
}
.bb-table-wrap th, .bb-table-wrap td {
  padding: 12px 15px;
  border-bottom: 1px solid #e2e8f0;
  text-align: left;
  vertical-align: middle;
  line-height: 1.5;
}
.bb-table-wrap th {
  background: #f8fafc;
  font-weight: 700;
  position: sticky;
  top: 0;
  z-index: 2;
  color: #1e293b;
  box-shadow: 0 1px 0 #e2e8f0; 
}
.bb-table-wrap tbody tr:hover { background: #f1f5f9; }
.bb-table-wrap.bb-dark { background: #1e293b; border-color: #334155; }
.bb-table-wrap.bb-dark th { background: #0f172a; color: #e2e8f0; border-color: #334155; box-shadow: 0 1px 0 #334155; }
.bb-table-wrap.bb-dark td { border-color: #334155; color: #cbd5e1; }
.bb-table-wrap.bb-dark tbody tr:hover { background: #334155; }
.no-wrap th, .no-wrap td { white-space: nowrap; }
</style>`;
}

function getOutputJS() {
    // IMPORTANT: Escape the closing script tag string!
    return `<script>
document.addEventListener("DOMContentLoaded", function() {
  var tables = document.querySelectorAll(".bb-table-wrap table"); // Target specific tables inside wrapper
  
  // 1. Auto-wrap tables if user pasted plain table (fallback)
  document.querySelectorAll("table").forEach(function(tbl) {
      if (!tbl.closest(".bb-table-wrap") && !tbl.classList.contains("editor-table")) {
         // Optional: You can auto-wrap here if needed, but we rely on generated HTML structure
      }
  });

  // 2. Drag to Scroll Logic
  document.querySelectorAll(".bb-table-wrap").forEach(function(wrap) {
      var isDown = false, startX, scrollLeft;
      wrap.addEventListener("mousedown", function(e) {
          isDown = true; wrap.style.cursor = "grabbing";
          startX = e.pageX - wrap.offsetLeft;
          scrollLeft = wrap.scrollLeft;
      });
      wrap.addEventListener("mouseleave", function() { isDown = false; wrap.style.cursor = "grab"; });
      wrap.addEventListener("mouseup", function() { isDown = false; wrap.style.cursor = "grab"; });
      wrap.addEventListener("mousemove", function(e) {
          if (!isDown) return;
          e.preventDefault();
          var x = e.pageX - wrap.offsetLeft;
          var walk = (x - startX) * 2; // Scroll-fast
          wrap.scrollLeft = scrollLeft - walk;
      });
  });

  // 3. Dark Mode Detection (Simple)
  function checkDark() {
      var isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      // Check body class for manual toggles common in Blogger
      if(document.body.classList.contains('dark') || document.body.classList.contains('dark-mode')) isDark = true;
      
      document.querySelectorAll(".bb-table-wrap").forEach(function(w){
          isDark ? w.classList.add('bb-dark') : w.classList.remove('bb-dark');
      });
  }
  checkDark();
  if(window.matchMedia) window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', checkDark);
});
<\/script>`; // ESCAPED SLASH HERE IS CRITICAL
}

function generateCode() {
    const tableHTML = buildTableHTML();
    const css = getOutputCSS(els.minw.value, els.maxh.value);
    const js = getOutputJS();
    
    // Combine structure
    return `${css}\n<div class="bb-table-wrap">\n${tableHTML}\n</div>\n${js}`;
}

/* --- ACTIONS --- */

els.generate.addEventListener('click', () => {
    const code = generateCode();
    els.codeOut.value = code;
    
    // Clear preview to force user to click preview button (to see updated version)
    // els.previewBox.innerHTML = '<div style="padding:20px;text-align:center;color:#666">Kode diperbarui. Klik "Lihat Preview".</div>';
});

els.previewBtn.addEventListener('click', () => {
    const tableHTML = buildTableHTML();
    const css = getOutputCSS(els.minw.value, els.maxh.value);
    
    // In preview, we DO NOT inject the full JS because it might conflict with the editor
    // Instead we just inject CSS and HTML
    const previewHTML = `${css}<div class="bb-table-wrap" style="margin:0">${tableHTML}</div>`;
    els.previewBox.innerHTML = previewHTML;
});

els.copyBtn.addEventListener('click', () => {
    els.codeOut.select();
    document.execCommand('copy'); // Fallback safe
    const ori = els.copyBtn.textContent;
    els.copyBtn.textContent = "Disalin!";
    setTimeout(() => els.copyBtn.textContent = ori, 1500);
});

els.downloadBtn.addEventListener('click', () => {
    const blob = new Blob([els.codeOut.value], {type: "text/html"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "tabel-blogger.html";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
});

})();
</script>
</body>
</html>
